commit f4b6f27e367ace763bcb3508a26c2634e7b82491
Author: Stéphane Graber <stgraber@ubuntu.com>
Date:   Thu Aug 24 19:28:10 2017 -0400

    Fix live migration (bad URL in dumpsuccess)
    
    Closes #3715
    
    Signed-off-by: Stéphane Graber <stgraber@ubuntu.com>

diff --git a/client/lxd.go b/client/lxd.go
index 3473e31..12ccdee 100644
--- a/client/lxd.go
+++ b/client/lxd.go
@@ -76,10 +76,7 @@ func (r *ProtocolLXD) RawQuery(method string, path string, data interface{}, ETa
 //
 // This should only be used by internal LXD tools.
 func (r *ProtocolLXD) RawWebsocket(path string) (*websocket.Conn, error) {
-	// Generate the URL
-	url := fmt.Sprintf("%s%s", r.httpHost, path)
-
-	return r.rawWebsocket(url)
+	return r.websocket(path)
 }
 
 // Internal functions
diff --git a/lxd/main_migratedumpsuccess.go b/lxd/main_migratedumpsuccess.go
index 663e6f9..56fce2e 100644
--- a/lxd/main_migratedumpsuccess.go
+++ b/lxd/main_migratedumpsuccess.go
@@ -2,7 +2,7 @@ package main
 
 import (
 	"fmt"
-	"net/url"
+	"strings"
 
 	"github.com/lxc/lxd/client"
 	"github.com/lxc/lxd/shared/api"
@@ -18,13 +18,14 @@ func cmdMigrateDumpSuccess(args []string) error {
 		return err
 	}
 
-	conn, err := c.RawWebsocket(fmt.Sprintf("/1.0/operations/%s/websocket?%s", args[1], url.Values{"secret": []string{args[2]}}))
+	url := fmt.Sprintf("%s/websocket?secret=%s", strings.TrimPrefix(args[1], "/1.0"), args[2])
+	conn, err := c.RawWebsocket(url)
 	if err != nil {
 		return err
 	}
 	conn.Close()
 
-	resp, _, err := c.RawQuery("GET", fmt.Sprintf("/1.0/operations/%s/wait", args[1]), nil, "")
+	resp, _, err := c.RawQuery("GET", fmt.Sprintf("%s/wait", args[1]), nil, "")
 	if err != nil {
 		return err
 	}
